- block:
  - name: Check if Homebrew is installed
    stat:
      path: /usr/local/bin/brew
    register: homebrew_check

  - name: Install Homebrew if not present
    shell: /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    when: not homebrew_check.stat.exists

  - name: Update Homebrew
    homebrew:
      update_homebrew: yes

  - name: Install Homebrew packages
    homebrew:
      name: "{{ brew_packages }}"
      state: present

  - name: Install Homebrew Cask applications
    homebrew_cask:
      name: "{{ brew_cask_packages }}"
      state: present
  become: false
